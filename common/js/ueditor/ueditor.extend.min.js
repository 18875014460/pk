!function(UE){var apiServer=window.ShiYue&&window.ShiYue.base?window.ShiYue.base:"",config="/common/js/ueditor/ueditor.upload.config.json";UE.Editor.prototype.__loadServerConfig_=UE.Editor.prototype.loadServerConfig,UE.Editor.prototype.loadServerConfig=function(){var me=this;setTimeout(function(){me._serverConfigLoaded=!1,UE.ajax.request(config,{method:"GET",onsuccess:function(r){try{var config=eval("("+r.responseText+")");!config.imageUrlPrefix||-1!=config.imageUrlPrefix.indexOf("http://")&&-1!=config.imageUrlPrefix.indexOf("https://")||(config.imageUrlPrefix=apiServer+config.imageUrlPrefix),UE.utils.extend(me.options,config),me.fireEvent("serverConfigLoaded"),me._serverConfigLoaded=!0}catch(e){"object"==typeof console&&console.error(me.getLang("loadconfigFormatError"))}}})})},UE.Editor.prototype.__getActionUrl_=UE.Editor.prototype.getActionUrl,UE.Editor.prototype.getActionUrl=function(e){return"uploadimage"==e||"uploadscrawl"==e||"uploadfile"==e||"uploadvideo"==e?apiServer+"/zuul/api/storage/upload?serverid=editor":"listimage"==e?"":"listfile"==e?"":this.__getActionUrl_.call(this,e)},UE.Editor.prototype.getContentImgs=function(){var e=[],t=this.body.querySelectorAll(".uploadimages");if(!t||t.length<1)return e;for(var i=0;i<t.length;i++){var o=t[i];o&&e.push({fileSize:o.getAttribute("filesize")||"",fileType:o.getAttribute("filetype")||"",suffix:o.getAttribute("suffix")||"",id:o.getAttribute("fileid")||"",src:o.getAttribute("src")||"",name:o.getAttribute("title")||""})}return e},UE.plugin.register("simpleupload",function(){var e,t=this,i=!1,o=UE.dom.domUtils,a=UE.utils;function n(){var n=e.offsetWidth||20,r=e.offsetHeight||20,s=document.createElement("iframe"),l="display:block;width:100px;height:"+r+"px;overflow:hidden;border:0;margin:0;padding:0;position:absolute;top:0;right:0;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0;cursor:pointer;";o.on(s,"load",function(){var e,d,c,u=(+new Date).toString(36);c=(d=s.contentDocument||s.contentWindow.document).body,(e=d.createElement("div")).innerHTML='<form id="edui_form_'+u+'" target="edui_iframe_'+u+'" method="POST" enctype="multipart/form-data" action="'+t.getOpt("serverUrl")+'" style="'+l+'"><input id="edui_input_'+u+'" type="file" accept="image/gif,image/jpeg,image/png,image/jpg,image/bmp" name="'+t.options.imageFieldName+'" style="'+l+'" title="'+(t.getLang("labelMap.simpleupload")||"")+'"></form><iframe id="edui_iframe_'+u+'" name="edui_iframe_'+u+'" style="display:none;width:0;height:0;border:0;margin:0;padding:0;position:absolute;"></iframe>',e.className="edui-"+t.options.theme,e.id=t.ui.id+"_iframeupload",c.style.cssText=l,c.style.width=n+"px",c.style.height=r+"px",c.appendChild(e),c.parentNode&&(c.parentNode.style.width=n+"px",c.parentNode.style.height=n+"px");var p=d.getElementById("edui_form_"+u),g=d.getElementById("edui_input_"+u),m=d.getElementById("edui_iframe_"+u);o.on(g,"change",function(){if(g.value){var e="loading_"+(+new Date).toString(36),i=a.serializeParam(t.queryCommandValue("serverparam"))||"",n=t.getActionUrl(t.getOpt("imageActionName")),r=t.getOpt("imageAllowFiles");if(t.focus(),t.execCommand("inserthtml",'<img class="loadingclass" id="'+e+'" src="'+t.options.themePath+t.options.theme+'/images/spacer.gif" title="'+(t.getLang("simpleupload.loading")||"")+'" >'),t.getOpt("imageActionName")){var s=g.value,l=s?s.substr(s.lastIndexOf(".")):"";!l||r&&-1==(r.join("")+".").indexOf(l.toLowerCase()+".")?c(t.getLang("simpleupload.exceedTypeError")):(o.on(m,"load",d),p.action=a.formatUrl(n+(-1==n.indexOf("?")?"?":"&")+i),window.$(p).ajaxSubmit({success:d}))}else errorHandler(t.getLang("autoupload.errorLoadConfig"))}function d(i){try{var a,n,r=(m.contentDocument||m.contentWindow.document).body,s=r.innerText||r.textContent||i||"";if("string"==typeof s&&s&&(s=s.replace(/<pre>|<\/pre>/gi,"")),200==(a="object"==typeof s?s:new Function("return "+s)()).status&&a.data){var l=a.data;(n=t.document.getElementById(e)).setAttribute("src",t.options.imageUrlPrefix+l.id),n.setAttribute("fileid",l.id||""),n.setAttribute("title",l.name||""),n.setAttribute("alt",l.name||""),n.setAttribute("suffix",l.suffix||""),n.setAttribute("filetype",l.fileType||""),n.setAttribute("filesize",l.fileSize||""),n.setAttribute("class","uploadimages"),n.removeAttribute("id"),o.removeClasses(n,"loadingclass")}else 200!=a.status&&a.message?c&&c(a.message):c&&c(t.getLang("simpleupload.loadError")+"-1")}catch(e){c&&c(t.getLang("simpleupload.loadError"))}p.reset(),o.un(m,"load",d)}function c(i){if(e){var a=t.document.getElementById(e);a&&o.remove(a),t.fireEvent("showmessage",{id:e,content:i,type:"error",timeout:4e3})}}});var f;t.addListener("selectionchange",function(){clearTimeout(f),f=setTimeout(function(){var e=t.queryCommandState("simpleupload");g.disabled=-1==e&&"disabled"},400)}),i=!0}),s.style.cssText=l,e.appendChild(s)}return{bindEvents:{ready:function(){a.cssRule("loading",".loadingclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}\n.loaderrorclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}",this.document)},simpleuploadbtnready:function(i,o){e=o,t.afterConfigReady(n)}},outputRule:function(e){a.each(e.getNodesByTagName("img"),function(e){/\b(loaderrorclass)|(bloaderrorclass)\b/.test(e.getAttr("class"))&&e.parentNode.removeChild(e)})},commands:{simpleupload:{queryCommandState:function(){return i?0:-1}}}}}),function(e){var t="equation";e.I18N["zh-cn"].labelMap[t]="插入公式",e.ui.equation=function(i){var o=e.ui,a=i.options.labelMap[t]||i.getLang("labelMap."+t)||"",n=new e.ui.Dialog({iframeUrl:i.options.UEDITOR_HOME_URL+"dialogs/math/index.html",editor:i,name:t,title:a,className:"edui-for-"+t,cssRules:"width:600px;height:350px;",closeDialog:i.getLang("closeDialog"),buttons:[{className:"edui-okbutton",label:i.getLang("ok"),editor:i,onclick:function(){var e=$("#"+n.id+"_iframe").contents(),t=e.find("#jme-math"),i=e.find("#matheqCode"),o=t.html(),a=i.html();'<span class="textarea"><textarea></textarea></span>'!=o?(o="<span data-code="+a+' data-png-src="http://latex.codecogs.com/png.latex?'+a+'" data-gif-src="http://latex.codecogs.com/gif.latex?'+a+'" class="mathquill-rendered-math" style="font-size: 20px;" >'+o+"</span><span>&nbsp;</span>",this.editor.execCommand("insertHtml",o),n.close(!0)):n.close(!0)}},{className:"edui-cancelbutton",label:i.getLang("cancel"),editor:i,onclick:function(){n.close(!0)}}]});return o.buttons[t]=new o.Button({title:a,className:"edui-for-"+t,theme:i.options.theme,cssRules:'background: url("'+i.options.UEDITOR_HOME_URL+'dialogs/math/images/icon.png") !important',onclick:function(){n.render(),n.open()}}),o.buttons[t]}}(UE)}(UE);